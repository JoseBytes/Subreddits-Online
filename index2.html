<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Detección automática de código QR</title>
  <style>
    #video {
      width: 100%;
      height: auto;
    }
    #overlay {
      position: absolute;
      border: 5px solid #0f0;
      box-sizing: border-box;
      display: none;
    }
  </style>
</head>
<body>
  <div>
    <video id="video" autoplay></video>
    <div id="overlay"></div>
  </div>
  <div>
    <p>Resultado:</p>
    <p id="qrResult"></p>
  </div>

  <!-- Agrega las bibliotecas necesarias a través de CDN -->
  <script src="https://unpkg.com/@zxing/library@0.18.5"></script>
  <script src="https://cdn.jsdelivr.net/npm/@zxing/browser@0.18.5"></script>

  <script>
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const qrResult = document.getElementById('qrResult');

    // Accede a la cámara del dispositivo
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(function(stream) {
        video.srcObject = stream;
        video.play();

        // Crea el objeto de escaneo con ZXing
        const codeReader = new ZXing.BrowserQRCodeReader();

        // Detecta los códigos QR automáticamente
        codeReader.decodeOnceFromVideoDevice(undefined, 'video', (result, error) => {
          if (result) {
            // Si se detecta un código QR, muestra el resultado y el encuadre
            qrResult.textContent = result.text;
            overlay.style.display = 'block';
            overlay.style.left = result.location.topLeftCorner.x + 'px';
            overlay.style.top = result.location.topLeftCorner.y + 'px';
            overlay.style.width = result.location.topRightCorner.x - result.location.topLeftCorner.x + 'px';
            overlay.style.height = result.location.bottomRightCorner.y - result.location.topRightCorner.y + 'px';
          } else {
            // Si no se detecta un código QR, oculta el encuadre
            overlay.style.display = 'none';
          }

          // Vuelve a detectar los códigos QR automáticamente
          codeReader.decodeOnceFromVideoDevice(undefined, 'video', (result, error) => {});
        });
      })
      .catch(function(error) {
        console.log('Error al acceder a la cámara: ' + error);
      });
  </script>
</body>
</html>
