<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Escaneo de código QR</title>
  <style>
    #video {
      width: 100%;
      height: auto;
    }
    #overlay {
      position: absolute;
      border: 5px solid #0f0;
      box-sizing: border-box;
      display: none;
    }
  </style>
</head>
<body>
  <div>
    <video id="video" autoplay></video>
    <div id="overlay"></div>
  </div>
  <div>
    <p>Resultado:</p>
    <p id="qrResult"></p>
  </div>

  <!-- Agrega la biblioteca ZXing a través de un CDN -->
  <script src="https://unpkg.com/@zxing/library@0.18.5"></script>

  <script>
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const qrResult = document.getElementById('qrResult');

    // Accede a la cámara del dispositivo
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
      .then(function(stream) {
        video.srcObject = stream;
        video.play();

        // Crea el objeto de escaneo con ZXing
        const codeReader = new ZXing.BrowserQRCodeReader();

        // Agrega un listener al video para detectar códigos QR en tiempo real
        video.addEventListener('canplay', function() {
          // Repite el proceso cada cierto tiempo
          setInterval(function() {
            // Analiza los datos de la imagen y detecta códigos QR
            codeReader.decodeFromVideoDevice(undefined, 'video')
              .then(result => {
                // Si se detecta un código QR, muestra el resultado y el encuadre
                qrResult.textContent = result.text;
                overlay.style.display = 'block';
                overlay.style.left = result.location.topLeftCorner.x + 'px';
                overlay.style.top = result.location.topLeftCorner.y + 'px';
                overlay.style.width = result.location.topRightCorner.x - result.location.topLeftCorner.x + 'px';
                overlay.style.height = result.location.bottomRightCorner.y - result.location.topRightCorner.y + 'px';
              })
              .catch(err => {
                // Si no se detecta un código QR, oculta el encuadre
                overlay.style.display = 'none';
              });
          }, 500); // Puedes ajustar el intervalo de tiempo según tus necesidades
        });
      })
      .catch(function(error) {
        console.log('Error al acceder a la cámara: ' + error);
      });
  </script>
</body>
</html>
